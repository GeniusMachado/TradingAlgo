{% extends "base.html" %}
{% block content %}
<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-8">
    <div>
        <h1 class="text-2xl font-bold text-white">V23 Journal Terminal <span class="text-gray-500 text-sm">| {{ analysis.symbol }}</span></h1>
        <span class="bg-yellow-500/20 text-yellow-500 text-xs px-2 py-1 rounded font-bold">SIMULATION MODE</span>
    </div>
    <div class="flex gap-2">
      <form action="/api/reset" method="post"><button class="bg-gray-700 text-white px-4 py-2 rounded hover:bg-gray-600">Reset</button></form>
      <form action="/api/execute" method="post"><input type="hidden" name="symbol" value="NQ"><input type="hidden" name="action" value="BUY"><button class="bg-green-600 text-white px-6 py-2 rounded font-bold hover:bg-green-500 shadow-lg">Paper Long</button></form>
      <form action="/api/execute" method="post"><input type="hidden" name="symbol" value="NQ"><input type="hidden" name="action" value="SELL"><button class="bg-red-600 text-white px-6 py-2 rounded font-bold hover:bg-red-500 shadow-lg">Paper Short</button></form>
    </div>
  </div>

  <!-- ACCOUNT HEALTH -->
  <div class="grid md:grid-cols-4 gap-6 mb-8">
    <div class="glass p-6 rounded-xl border-l-4 {{ 'border-green-500' if account.daily_pl >= 0 else 'border-red-500' }}">
      <div class="text-gray-400 text-xs uppercase font-bold mb-2">Daily P&L</div>
      <div class="text-2xl font-black text-white">${{ account.daily_pl }}</div>
    </div>
    <div class="glass p-6 rounded-xl border-l-4 border-blue-500">
      <div class="text-gray-400 text-xs uppercase font-bold mb-2">Balance</div>
      <div class="text-2xl font-mono text-white">${{ account.balance }}</div>
    </div>
    
    <!-- STATS -->
    <div class="glass p-6 rounded-xl border-l-4 border-purple-500">
      <div class="text-gray-400 text-xs uppercase font-bold mb-2">Win Rate</div>
      <div class="text-2xl font-bold text-white">{{ account.win_rate }}%</div>
    </div>

    <div class="glass p-6 rounded-xl border-l-4 border-white">
      <div class="text-gray-400 text-xs uppercase font-bold mb-2">Total Trades</div>
      <div class="text-2xl font-bold text-white">{{ account.trades_count }}</div>
    </div>
  </div>

  <!-- TRADE JOURNAL -->
  <div class="glass rounded-xl border border-white/10 mb-6 overflow-hidden">
    <div class="bg-slate-800/50 px-6 py-4 border-b border-white/10 font-bold text-white">Automated Trade Journal (Last 10)</div>
    <div class="overflow-x-auto">
      <table class="w-full text-sm text-left text-gray-400">
        <thead class="text-xs uppercase bg-slate-900 text-gray-400">
          <tr>
            <th class="px-6 py-3">Time</th>
            <th class="px-6 py-3">Action</th>
            <th class="px-6 py-3">Price</th>
            <th class="px-6 py-3">Reasoning</th>
            <th class="px-6 py-3">Result</th>
            <th class="px-6 py-3 text-right">P&L</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-800">
          {% for trade in account.history | reverse %}
          <tr class="hover:bg-slate-800/50 transition">
            <td class="px-6 py-4">{{ trade.time }}</td>
            <td class="px-6 py-4 font-bold {{ 'text-green-400' if trade.action == 'BUY' else 'text-red-400' }}">{{ trade.action }}</td>
            <td class="px-6 py-4 font-mono">{{ trade.price }}</td>
            <td class="px-6 py-4 text-gray-300">{{ trade.reasoning }}</td>
            <td class="px-6 py-4">
              {% if trade.result == 'WIN' or trade.result == 'CLOSED_PROFIT' %}
                 <span class="bg-green-500/20 text-green-400 px-2 py-1 rounded text-xs font-bold">WIN</span>
              {% else %}
                 <span class="bg-red-500/20 text-red-400 px-2 py-1 rounded text-xs font-bold">LOSS</span>
              {% endif %}
            </td>
            <td class="px-6 py-4 text-right font-mono font-bold {{ 'text-green-400' if trade.pnl > 0 else 'text-red-400' }}">${{ trade.pnl }}</td>
          </tr>
          {% else %}
          <tr><td colspan="6" class="px-6 py-8 text-center text-gray-600 italic">No trades taken yet in this session.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

  <!-- Chart Area -->
  <div class="glass rounded-xl overflow-hidden h-[550px] border border-slate-700">
    <div class="tradingview-widget-container" style="height:100%;width:100%">
      <div id="tradingview_123" style="height:100%;width:100%"></div>
      <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
      <script type="text/javascript">
      new TradingView.widget({"autosize": true,"symbol": "CME_MINI:NQ1!","interval": "5","timezone": "America/New_York","theme": "dark","style": "1","locale": "en","enable_publishing": false,"backgroundColor": "rgba(15, 23, 42, 1)","gridColor": "rgba(255, 255, 255, 0.05)","hide_top_toolbar": false,"container_id": "tradingview_123"});
      </script>
    </div>
  </div>
</div>
{% endblock %}
